<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Get Prolific ID</title>
  <script src = "./extra_functions/jquery-3.4.1.js" type="text/javascript"></script>
  <script src="jatos.js"></script>
</head>
<body style="background-color:#b9c6c7;">

  <div align="center" style="display: flex; flex-direction: column; margin: auto; flex: 1 1 100%; width: 90%; height: 90%;">
    <div id="prolific_div" style="visibility:hidden; font-family: 'Open Sans', 'Arial', sans-serif; font-size: 150%; line-height: 1.2em;">
      <br><br><br><p style="font-family: 'Open Sans', 'Arial', sans-serif; line-height: 1.6em; vertical-align:middle">Please enter your prolific ID (you can copy&amp;paste from the prolific website) and press ENTER: <textarea id="prolific_id" rows="1" cols="20" style="vertical-align:middle; font-size: 18px; line-height: 1.5em;"></textarea></p>
    </div>
    <div id="error_msg" style="font-family: 'Open Sans', 'Arial', sans-serif; font-size: 150%; line-height: 1.2em;"></div>
  </div>
</body>
<script>

    // var mw = 750;
    // var mh = 700;
    var mw = 600;
    var mh = 600;    

    jatos.onLoad(function() {

      // Create a variable to hold all the results from components. For some of the components, the keys will be created at the time
      jatos.studySessionData.outputData = {
        phase_1_results: [],
        phase_2_results: [],
        phase_1_practice_results: [],
        phase_2_practice_results: [],        
        debrief_results: [],
        breaks_results: []
      };

      // Lines below are for manual prolific ID entry:
      // $("#prolific_id").keypress(function (e) {
      //   if(e.which == 13) { 
      //     e.preventDefault();       
      //     jatos.studySessionData.prolific_ID = $("#prolific_id").val();
      //     var result_data = {
      //       prolific_ID: jatos.studySessionData.prolific_ID,
      //       window_width: window.innerWidth,
      //       window_height: window.innerHeight,
      //     }
      //     jatos.addJatosIds(result_data);
      //     jatos.submitResultData("[get_pid_comp_start---" + 
      //       JSON.stringify(result_data) + 
      //       "---get_pid_comp_end]", jatos.startNextComponent);
      //   }
      // });
      // Lines ABOVE are for manual prolific ID entry:
        
      // Comment out the lines below to disable automatic prolicit ID assignment for debugging
      jatos.studySessionData.prolific_ID = "test";

      var result_data = {
        prolific_ID: jatos.studySessionData.prolific_ID,
      }
      jatos.addJatosIds(result_data);
      jatos.submitResultData('[get_pid_comp_start---' + JSON.stringify(result_data) + 
      '---get_pid_comp_end]', jatos.startNextComponent);     
      // Comment out the lines ABOVE to disable automatic prolicit ID assignment for debugging

      var w = window.innerWidth;
      var h = window.innerHeight;

      if(w < mw || h < mh) {
        var interval = setInterval(function(){
          var w = window.innerWidth;
          var h = window.innerHeight;
          if(w < mw || h < mh){
            $("#error_msg").html('<p>Your browser window is too small to complete this experiment. '+
              'Please maximize the size of your browser window. If your browser window is already maximized, try entering the fullscreen mode. '+
              'If that does not help either, you will not be able to complete this experiment.</p>'+
              '<p>The minimum width is '+mw+'px. Your current width is '+w+'px.</p>'+
              '<p>The minimum height is '+mh+'px. Your current height is '+h+'px.</p>');
          } else {
            clearInterval(interval);
            document.getElementById("error_msg").style.visibility = "hidden";
            document.getElementById("prolific_div").style.visibility = "visible";

            return;
          }
        }, 100);
      } else {
        document.getElementById("error_msg").style.visibility = "hidden";
        document.getElementById("prolific_div").style.visibility = "visible";

   
      }; 

        // document.getElementById("error_msg").style.visibility = "hidden";
        // document.getElementById("prolific_div").style.visibility = "visible";

    });
</script>