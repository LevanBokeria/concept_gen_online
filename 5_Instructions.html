<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0">
    <title>Instructions</title>	
	<script src="jspsych-6.1.0/jspsych.js" ></script>
	<script src='./jspsych-6.1.0/plugins/jspsych-instructions.js'></script>
	<script src="extra_functions/jspsych-instructions-timer-enhanced.js"></script>
	<script src='./extra_functions/helper_functions.js'></script>
	<script src="jatos.js"></script>
	<link rel="stylesheet" href="jspsych-6.1.0/css/jspsych.css" type="text/css"></link>
	
	<style>	body {background-color: #b9c6c7; font-family: sans-serif; color: black;} </style>
	<style> p {font-size: 100%; margin-top:0px; margin-right:20px; margin-bottom:10px; margin-left: 20px;} </style>
	<style> ul {font-size: 125%; margin-top:0px; margin-right:100px; margin-bottom:10px; margin-left: 100px; cursor:default;} </style>
	<style> .instruct{width:100%; color: black; text-align:center; cursor:default;} </style>
	<style> .header {width:100%; color: black; text-align: center;cursor:default;} </style>
  </head>

  <body>
  <script>

		//start timeline
		jatos.onLoad(function() {

			// What phase and session is this?
			let [curr_phase,phase_string,curr_session] = getPhaseAndSession() 
			let curr_concept = jatos.studySessionData.inputData.concepts[phase_string]
			let nTargets = jatos.studySessionData.inputData.basic_parameters.nTargets


			// Create HTML elements 
			let targets_on_page = document.createElement('div')
			targets_on_page.id = 'targets_on_page'
			targets_on_page.style = 'display: flex; justify-content: center; align-items: center;'

			let names_on_page = document.createElement('div')
			names_on_page.id = 'names_on_page'
			names_on_page.style = 'display: flex; justify-content: center; align-items: center;'

			let target_array = jatos.studySessionData.inputData.basic_parameters.targetPathsUsed[phase_string]
			let target_names = jatos.studySessionData.inputData.basic_parameters.targetNamesUsed[phase_string]
			
			for (i=0; i<target_array.length; i++){
				// Create the names flexbox
				let iN = document.createElement('P')
				iN.id = 'target_name_' + (i+1)
				iN.innerText = target_names[i]
				iN.style = 'height: 20px; margin: 10px; font-size: 15px; text-align: center;'

				// Create the target elements
				let iT = document.createElement('img')
				iT.id = 'target_' + (i+1)
				iT.src = target_array[i]
				iT.style = 'width: 50px; height: 50px'

				targets_on_page.appendChild(iT)
				names_on_page.appendChild(iN)
			}

			// What component to start next
			var comp_to_start;
			curr_phase == 1 ? comp_to_start = jatos.studySessionData.script_comp_pos.practice_trials : comp_to_start = jatos.studySessionData.script_comp_pos.phase_pa

			//make a timeline
			let timeline =[]; 

			let instructions = {
				phase_1: {
					type: 'instructions',
					pages : [				
							'<div class= "header">'+
								'<h1> Game Instructions </h1>'+
							'</div>'+	
							'<div class="instruct">'+
								'<p>Welcome to the experiment!</p>' + 
								'<p>You will play a game that will test your perception and memory skills!</p>' +
								'<p>The game consists of 3 learning phases, and a debriefing survey at the end.</p>' +
								'<p>Lets start with phase 1 of learning. Click "Next" for instructions. </p>' +
							'</div>',
							'<div class= "header">'+
								'<h1> Please go into fullscreen mode by pressing F11</h1>'+
							'</div>',								
							'<div class= "header">'+
								'<h1> Phase 1 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct">'+
								'<p>Below, you can see some examples of ' + 
									curr_concept.concept_object + 
									' that differ from each other by the length of their ' + 
									curr_concept.dim1_name + ' and ' + 
									curr_concept.dim2_name + '.</p>' + 
								'<div id="all_pictures">' +
									'<img src="./img/initial_all_pictures/'+ 
									curr_concept.concept_space 
									+'.png" alt="all_pictures" '+
									'style="height:40%;width:40%; object-fit:contain;"></img>' + 
								"</div>" +
								'<p> '+ nTargets +
									' of these ' + curr_concept.concept_object + 
									' are hiding the ' + 
									nTargets +
									' toys you see below.</p>' +
									names_on_page.outerHTML + targets_on_page.outerHTML +
									'<p>Your job is to find out which of the '+ 
									nTargets +' ' + 
									curr_concept.concept_object + 
									' are hiding which of these toys as fast as you can! ' + 
								'</p>' +
							'</div>',
							'<div class= "header">'+
								'<h1> Phase 1 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct"> <br>'+
								'<p>On each trial of learning, you will see one of the toys and two suspect ' + 
								curr_concept.concept_object + ' on the screen.</p>' + 
								'<p>You will have to learn which of the two ' + 
								curr_concept.concept_object + ' is hiding the toy you see.</p>' +
								'<p>Use the "1" and "2" keys of your keyboard to make your choice.</p>' +
								'<p>You will then see if your were right or wrong, and your score will be recorded.</p>' +								
							'</div>',
							'<div class= "header">'+
								'<h1> Phase 1 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct"> <br>'+
								'<p>In the beginning, you will have to just guess the right answers.</p>' +
								'<p>Hopefully, after some trials you will learn to quickly recognize the '+ curr_concept.concept_object 
								+ ' that hide each toy.</p>' +								
							'</div>',							
							'<div class= "header">'+
								'<h1> Phase 1 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct"> <br>'+
								'<p>Lets do '+ 
									jatos.studySessionData.n_practice_trials + 
									' practice trials for the game, before beginning the actual learning.</p>' + 
								'<p><b>You will have ' + (jatos.studySessionData.timer_response_window/1000) + 
								' seconds on each trial to make your response!</b> </p>' +
								'<p>Please be as fast and as accurate as you can be!</p>' +							
							'</div>',																												
						],
						
						show_clickable_nav: true,
						button_label_next: '<span style="color: black"d;> <strong> Next </stong></span>',
				},
				phase_2: {
					type: 'instructions-timer-enhanced',
					pages : [				
							'<div class= "header">'+
								'<h1> Phase 2 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct"> <br>'+
								'<p> Welcome to phase 2 of the experiment!</p>' + 
								'<p> Phase 2 is similar to phase 1, but with important differences. </p>' +
								'<p> <strong> You will learn different associations, and will no longer have any practice sessions</strong>. </p>' +								
							'</div>',
							'<div class= "header">'+
								'<h1> Phase 2 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct">'+
								'<p>Below, you can see some examples of ' + 
									curr_concept.concept_object + 
									' that differ from each other by the length of their ' + 
									curr_concept.dim1_name + ' and ' + 
									curr_concept.dim2_name + '.</p>' + 
								'<div id="all_pictures">' +
									'<img src="./img/initial_all_pictures/'+ 
									curr_concept.concept_space 
									+'.png" alt="all_pictures" '+
									'style="height:40%;width:40%; object-fit:contain;"></img>' + 
								"</div>" +
								'<p> '+ nTargets +
									' of these ' + curr_concept.concept_object + 
									' are associated with the '+ 
									nTargets +
									' toys you see below.</p>' +
									names_on_page.outerHTML + targets_on_page.outerHTML +
									'<p>Your job is to find out which '+ 
									nTargets +' ' + 
									curr_concept.concept_object + 
									' are associated with which toys as fast as you can! ' + 
								'</p>' +
							'</div>',
							'<div class= "header">'+
								'<h1> Phase 2 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct"> <br>'+
								'<p>On each trial of learning, you will see one of the toys and two candidate ' + 
								curr_concept.concept_object + ' on the screen.</p>' + 
								'<p>You will have to guess which of the two ' + 
								curr_concept.concept_object + ' is correctly associated with the toy you see.</p>' +
								'<p>You can make a response using the keyboard keys "1" and "2" corresponding to the two ' + 
								curr_concept.concept_object + '.</p>' +
								'<p>You will then get feedback on whether you were correct or incorrect.</p>' +								
							'</div>',
							'<div class= "header">'+
								'<h1> Phase 2 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct"> <br>'+
								'<p>You will have ' + (jatos.studySessionData.timer_response_window/1000) + ' seconds on each trial to make your response! </p>' +
								'<p>Click Next to begin.</p>' +								
							'</div>',																												
						],
						
						show_clickable_nav: true,
						button_label_next: '<span style="color: black"d;> <strong> Next </stong></span>',
						timer_on: false
				},
				phase_3: {
					type: 'instructions',
					pages : [				
							'<div class= "header">'+
								'<h1> Phase 3 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct">'+
								'<p> Welcome to the final 3rd phase of the experiment!</p>' + 
								'<p> This phase is the same as phase 1, so it will test how well you can remember the associations from phase 1.</p>' +
								'<p> <strong>Note that you will NOT have any practice sessions.</strong> </p>' +
							'</div>',
							'<div class= "header">'+
								'<h1> Phase 3 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct">'+
								'<p>Below, you can see some examples of ' + 
									curr_concept.concept_object + 
									' that differ from each other by the length of their ' + 
									curr_concept.dim1_name + ' and ' + 
									curr_concept.dim2_name + '.</p>' + 
								'<div id="all_pictures">' +
									'<img src="./img/initial_all_pictures/'+ 
									curr_concept.concept_space 
									+'.png" alt="all_pictures" '+
									'style="height:40%;width:40%; object-fit:contain;"></img>' + 
								"</div>" +
								'<p> '+ nTargets +
									' of these ' + curr_concept.concept_object + 
									' are associated with the '+ 
									nTargets +
									' toys you see below.</p>' +
									names_on_page.outerHTML + targets_on_page.outerHTML +
									'<p>Your job is to find out which '+ 
									nTargets +' ' + 
									curr_concept.concept_object + 
									' are associated with which toys as fast as you can! ' + 
								'</p>' +
							'</div>',
							'<div class= "header">'+
								'<h1> Phase 3 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct"> <br>'+
								'<p>On each trial of learning, you will see one of the toys and two candidate ' + 
								curr_concept.concept_object + ' on the screen.</p>' + 
								'<p>You will have to guess which of the two ' + 
								curr_concept.concept_object + ' is correctly associated with the toy you see.</p>' +
								'<p>You can make a response using the keyboard keys "1" and "2" corresponding to the two ' + 
								curr_concept.concept_object + '.</p>' +
								'<p>You will then get feedback on whether you were correct or incorrect.</p>' +								
							'</div>',
							'<div class= "header">'+
								'<h1> Phase 3 Instructions </h1>'+
							'</div>'+	
							'<div class="instruct"> <br>'+
								'<p>You will have ' + (jatos.studySessionData.timer_response_window/1000) + ' seconds on each trial to make your response! </p>' +
								'<p>Click Next to begin.</p>' +								
							'</div>',																												
						],
						
						show_clickable_nav: true,
						button_label_next: '<span style="color: black"d;> <strong> Next </stong></span>',
				},
			}

			timeline.push(instructions[phase_string]);
			// timeline.push(instructions['phase_1']);			

			jsPsych.init({
				
				timeline: timeline,

				on_finish: function(data) {

					// Make JATOS remember that this session was run
                    jatos.studySessionData.latestFinishedComponentId    = jatos.componentId;
                    jatos.studySessionData.latestFinishedComponentPos   = jatos.componentPos;
                    jatos.studySessionData.latestFinishedComponentTitle = jatos.componentProperties.title;

					jatos.submitResultData("[instructions_start---" + 
					JSON.stringify(jatos.studySessionData) +
					"---instructions_end]", 
					jatos.startComponentByPos(comp_to_start));

					// jsPsych.data.displayData();
				}
			});

		});


	</script>
</body>
</html>