<!DOCTYPE html>
<html>
    <head>
        <title>6 Example Trials</title>
        <!-- <script src='jatos.js'></script> -->
        <script src='./jspsych-6.1.0/jspsych.js'></script>        
        <script src='./extra_functions/lodash.js'></script>
        <script src = './extra_functions/jquery-3.4.1.js' type='text/javascript'></script>
        <!-- <script src='extra_functions/jspsych-html-slider-response-smooth-tracking.js'></script>
        <script src='./extra_functions/custom_functions.js'> </script> -->
        <script src='./extra_functions/jspsych-plugin-playground.js'></script>
        <script src='./extra_functions/jspsych-free-sort-modified.js'></script>        
        <link href='./jspsych-6.1.0/css/jspsych.css' rel='stylesheet' type='text/css'></link>
    </head>
    <body></body>
    <script>

        var baseTrialArray = []


        // Now, allocate coordinates for all empty location
        var targetCoordsNames = {
            pointNamesEmpty: ['E1','E2','E3','E4','E5','E6','E7','E8','E9','E10','E11','E12','E13','E14','E15','E16'],
            pointNamesUsed: ['E1','E2','E3','E4','E5','E6','E7','E8','E9','E10','E11','E12','E13','E14','E15','E16'],
            pointNamesTarget: ['T1','T2','T3','T4','T5','T6'],
            imgNamesEmpty: Array(16).fill('Empty'),
            imgNamesTarget: ['Tree','Santa','Bell','Sledge','Gingerman','Bear'],
            imgNamesUsed: Array(16).fill('Empty'),
            pointXCoord: [],
            pointYCoord: []
        }
        for (iX = 0; iX < 4; iX++){
            for (iY = 0; iY < 4; iY++){
                targetCoordsNames.pointXCoord.push(iX * 50 + 100);
                targetCoordsNames.pointYCoord.push(iY * 50 + 100);                
            }
        }

        // Basic parameters, not specific to any space
        var basic_parameters = {

            // Display
            sort_area_width: 750,
            sort_area_height: 700,
            prompt_target_width: 70,
            prompt_target_height: 70,

            // Targets
            nTargets: 3,
            targetPoints: [1,7,14]
        }

        // Create arrays with point and img names with appropriate number of targets at appropriate locations
        for (i=0; i<basic_parameters.nTargets; i++){

            targetCoordsNames.pointNamesUsed[basic_parameters.targetPoints[i]-1] = 
                targetCoordsNames.pointNamesTarget[i]

            targetCoordsNames.imgNamesUsed[basic_parameters.targetPoints[i]-1] = 
                targetCoordsNames.imgNamesTarget[i]
        }

        // Create all the combinations of targets and empty locations (imported from Matlab)
        var baseTrialArray = [
            {item1: "T1", item2: "T2"},
            {item1: "T1", item2: "T3"},
            {item1: "T1", item2: "E2"},
            {item1: "T1", item2: "E3"},
            {item1: "T1", item2: "E4"},
            {item1: "T1", item2: "E5"},
            {item1: "T1", item2: "E6"},
            {item1: "T1", item2: "E8"},
            {item1: "T1", item2: "E9"},
            {item1: "T1", item2: "E10"},
            {item1: "T1", item2: "E11"},
            {item1: "T1", item2: "E12"},
            {item1: "T1", item2: "E13"},
            {item1: "T1", item2: "E15"},
            {item1: "T1", item2: "E16"},
            {item1: "T2", item2: "T3"},
            {item1: "T2", item2: "E2"},
            {item1: "T2", item2: "E3"},
            {item1: "T2", item2: "E4"},
            {item1: "T2", item2: "E5"},
            {item1: "T2", item2: "E6"},
            {item1: "T2", item2: "E8"},
            {item1: "T2", item2: "E9"},
            {item1: "T2", item2: "E10"},
            {item1: "T2", item2: "E11"},
            {item1: "T2", item2: "E12"},
            {item1: "T2", item2: "E13"},
            {item1: "T2", item2: "E15"},
            {item1: "T2", item2: "E16"},
            {item1: "T3", item2: "E2"},
            {item1: "T3", item2: "E3"},
            {item1: "T3", item2: "E4"},
            {item1: "T3", item2: "E5"},
            {item1: "T3", item2: "E6"},
            {item1: "T3", item2: "E8"},
            {item1: "T3", item2: "E9"},
            {item1: "T3", item2: "E10"},
            {item1: "T3", item2: "E11"},
            {item1: "T3", item2: "E12"},
            {item1: "T3", item2: "E13"},
            {item1: "T3", item2: "E15"},
            {item1: "T3", item2: "E16"},
        ]

        var neck_legs_space = {
            concept_space: 'neck_legs_space',
            concept_object: 'birds',
            dim1_name: 'neck',
            dim2_name: 'legs',
            ex_pairs_height: 500, 
            ex_pairs_width: 350,
            ex_pairs_x_coord: 10,
            ex_pairs_y_coord: 10,
            fb_img_1_x_coord: 10,
            fb_img_1_y_coord: 400,
            fb_img_2_x_coord: 600,
            fb_img_2_y_coord: 400,            
            fb_text_1_x_coord: 70,
            fb_text_1_y_coord: 200,
            fb_text_2_x_coord: 170,
            fb_text_2_y_coord: 300
        }

        var curr_space_object = neck_legs_space

        // Create a counterballanced array indicating which item is the prompt item
        for(i = 0, j=0; i < baseTrialArray.length; i+=2, j++){
            if(j % 2 == 0){
                baseTrialArray[i].prompt_item_idx   = 1
                baseTrialArray[i+1].prompt_item_idx = 1
                baseTrialArray[i].foil_item_idx     = 2
                baseTrialArray[i+1].foil_item_idx   = 2                                
            } else {
                baseTrialArray[i].prompt_item_idx   = 2
                baseTrialArray[i+1].prompt_item_idx = 2
                baseTrialArray[i].foil_item_idx     = 1
                baseTrialArray[i+1].foil_item_idx   = 1                
            }
        }

        // Populate the baseTrialArray with details for each trial
        for(i = 0, j = 0; i < baseTrialArray.length; i++, j+=2) {

            // Randomize item1 and item2
            if (i % 2 == 0){
                [baseTrialArray[i].item1, baseTrialArray[i].item2] = [baseTrialArray[i].item2, baseTrialArray[i].item1]               
            }

            // point name of the prompt item?
            baseTrialArray[i].prompt_point_name = baseTrialArray[i]["item" + baseTrialArray[i].prompt_item_idx]
            // target name of the prompt item?
            baseTrialArray[i].prompt_img_name = 
                targetCoordsNames.imgNamesUsed[targetCoordsNames.pointNamesUsed.indexOf(baseTrialArray[i].prompt_point_name)]
            // prompt img path?
            baseTrialArray[i].prompt_img_path = './img/targets/' + baseTrialArray[i].prompt_img_name + '.png'

            // point name of the foil item?
            baseTrialArray[i].foil_point_name = baseTrialArray[i]["item" + baseTrialArray[i].foil_item_idx]
            // target name of the foil item?
            baseTrialArray[i].foil_img_name = 
                targetCoordsNames.imgNamesUsed[targetCoordsNames.pointNamesUsed.indexOf(baseTrialArray[i].foil_point_name)]
            // foil img path?
            baseTrialArray[i].foil_img_path = './img/targets/' + baseTrialArray[i].foil_img_name + '.png'

            // item1 index in point space?
            baseTrialArray[i].item1_point_idx = targetCoordsNames.pointNamesUsed.indexOf(baseTrialArray[i].item1)+1

            // item2 index in point space?
            baseTrialArray[i].item2_point_idx = targetCoordsNames.pointNamesUsed.indexOf(baseTrialArray[i].item2)+1            

            // Exemplar img to load?
            baseTrialArray[i].ex_pairs_img = './img/' + curr_space_object.concept_space + '/pair_imgs_both_orders/pairs_' + 
                baseTrialArray[i].item1_point_idx + '_' + baseTrialArray[i].item2_point_idx + '.png'
        }

        // Shuffle base trial array


        // //////////// FREE SORT PLUGIN //////////////////////////////
        var session_procedure = {
            timeline: [
                {
                    type: 'plugin-playground',
            
                    prompt_img_path: jsPsych.timelineVariable('prompt_img_path'),
                    prompt_img_width: basic_parameters.prompt_target_width,
                    prompt_img_height: basic_parameters.prompt_target_height,
                    prompt_img_x_coords: basic_parameters.sort_area_width/2 - basic_parameters.prompt_target_width/2,
                    prompt_img_y_coords: 50,
                    
                    ex_pairs_img:    jsPsych.timelineVariable('ex_pairs_img'),
                    ex_pairs_width:  curr_space_object.ex_pairs_width,
                    ex_pairs_height: curr_space_object.ex_pairs_height,
                    maintain_aspect_ratio: true,
                                                    
                    sort_area_width: 750,
                    sort_area_height: 700,
                    prompt: 'Which of the two pictures below are associated with this Christmas toy?',
                    choices: ['1', '2'],
                    response_ends_trial: true,
                    post_trial_gap: 500

                    // foil_img: baseTrialArray[0].foilImg,            
                    // fb_assoc1_img: '',
                    // fb_assoc2_img: '',

                    // fb_assoc1_x_coords: 50,
                    // fb_assoc1_y_coords: 300,
                    // fb_assoc2_x_coords: 650,
                    // fb_assoc2_y_coords: 400,
                    // fb_img1_x_coords: 50,
                    // fb_img1_y_coords: 300,
                    // fb_img2_x_coords: 650,
                    // fb_img2_y_coords: 400,            
                    
                    // fb_green_tick_img: './img/fb/green_tick.png',
                    // fb_green_tick_width: 20,
                    // fb_green_tick_height: 20,
                    // fb_red_x_img: './img/fb/red_X.png',
                    // fb_red_x_width: 20,
                    // fb_red_x_height: 20,
                    
                    // fb_correct_text: 'correct!',
                    // fb_incorrect_text: 'incorrect',
                    // post_response_text: 'press the SPACE key for next trial',   

                }
            ],

            timeline_variables: baseTrialArray
        };
 
        jsPsych.init({
            timeline: [session_procedure]
        });


        // ///////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////

    </script>
</html>
