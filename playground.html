<!DOCTYPE html>
<html>
    <head>
        <title>6 Example Trials</title>
        <!-- <script src='jatos.js'></script> -->
        <script src='./jspsych-6.1.0/jspsych.js'></script>        
        <script src='./extra_functions/lodash.js'></script>
        <script src = './extra_functions/jquery-3.4.1.js' type='text/javascript'></script>
        <!-- <script src='extra_functions/jspsych-html-slider-response-smooth-tracking.js'></script>
        <script src='./extra_functions/custom_functions.js'> </script> -->
        <script src='./extra_functions/jspsych-plugin-playground.js'></script>
        <script src='./extra_functions/jspsych-free-sort-modified.js'></script>        
        <link href='./jspsych-6.1.0/css/jspsych.css' rel='stylesheet' type='text/css'></link>
    </head>
    <body style="background-color:#99a3a4;"></body>
    <script>

        var baseTrialArray = []

        // Now, allocate coordinates for all empty location
        var targetCoordsNames = {
            pointNamesEmpty: ['E1','E2','E3','E4','E5','E6','E7','E8','E9','E10','E11','E12','E13','E14','E15','E16'],
            pointNamesUsed: ['E1','E2','E3','E4','E5','E6','E7','E8','E9','E10','E11','E12','E13','E14','E15','E16'],
            pointNamesTarget: ['T1','T2','T3','T4','T5','T6'],
            imgNamesEmpty: Array(16).fill('Empty'),
            imgNamesTarget: ['Tree','Santa','Bell','Sledge','Gingerman','Bear'],
            imgNamesUsed: Array(16).fill('Empty'),
            pointXCoord: [],
            pointYCoord: []
        }

        for (iX = 0; iX < 4; iX++){
            for (iY = 0; iY < 4; iY++){
                targetCoordsNames.pointXCoord.push(iX * 50 + 100);
                targetCoordsNames.pointYCoord.push(iY * 50 + 100);                
            }
        }

        // Basic parameters, not specific to any space
        var basic_parameters = {

            // Display
            sort_area_width: 750,
            sort_area_height: 700,
            prompt_target_width: 70,
            prompt_target_height: 70,
            get prompt_img_x_coords() {
                return this.sort_area_width/2 - this.prompt_target_width/2;
            },
            prompt_img_y_coords: 80,            

            // Targets
            nTargets: 3,
            targetPoints: [1,7,14],
            timer_till_fb: 3000,
            timer_after_response: 1000,
            timer_no_resp_fb_freeze: 2000,
            timer_response_window: 3000,

            // Feedback items
            fb_correct_img: './img/feedback/green_tick.png',
            fb_incorrect_img: './img/feedback/Red_x.png',
            audio_stimulus: './img/feedback/success.wav',

            // Peformance box
            score_box_width: 100,
            score_box_height: 100,
            score_box_target_width: 50,
            score_box_target_height: 50,
            score_box_score_font_size: 13, // Size of the score text, "100%"
            score_box_description_font_size: 15, // "Your scores"
        }

        // Create arrays with point and img names with appropriate number of targets at appropriate locations
        var score_box_target_names = []

        for (i=0; i<basic_parameters.nTargets; i++){

            targetCoordsNames.pointNamesUsed[basic_parameters.targetPoints[i]-1] = 
                targetCoordsNames.pointNamesTarget[i]

            targetCoordsNames.imgNamesUsed[basic_parameters.targetPoints[i]-1] = 
                targetCoordsNames.imgNamesTarget[i]

            // For the score box, create names of the target itesm
            score_box_target_names[i] = './img/targets/' + targetCoordsNames.imgNamesTarget[i] + '.png'
        }

        // Create all the combinations of targets and empty locations (imported from Matlab)
        var baseTrialArray = [
            {item1: "T1", item2: "T2"},
            {item1: "T1", item2: "T3"},
            {item1: "T1", item2: "E2"},
            {item1: "T1", item2: "E3"},
            {item1: "T1", item2: "E4"},
            {item1: "T1", item2: "E5"},
            {item1: "T1", item2: "E6"},
            {item1: "T1", item2: "E8"},
            {item1: "T1", item2: "E9"},
            {item1: "T1", item2: "E10"},
            {item1: "T1", item2: "E11"},
            {item1: "T1", item2: "E12"},
            {item1: "T1", item2: "E13"},
            {item1: "T1", item2: "E15"},
            {item1: "T1", item2: "E16"},
            {item1: "T2", item2: "T3"},
            {item1: "T2", item2: "E2"},
            {item1: "T2", item2: "E3"},
            {item1: "T2", item2: "E4"},
            {item1: "T2", item2: "E5"},
            {item1: "T2", item2: "E6"},
            {item1: "T2", item2: "E8"},
            {item1: "T2", item2: "E9"},
            {item1: "T2", item2: "E10"},
            {item1: "T2", item2: "E11"},
            {item1: "T2", item2: "E12"},
            {item1: "T2", item2: "E13"},
            {item1: "T2", item2: "E15"},
            {item1: "T2", item2: "E16"},
            {item1: "T3", item2: "E2"},
            {item1: "T3", item2: "E3"},
            {item1: "T3", item2: "E4"},
            {item1: "T3", item2: "E5"},
            {item1: "T3", item2: "E6"},
            {item1: "T3", item2: "E8"},
            {item1: "T3", item2: "E9"},
            {item1: "T3", item2: "E10"},
            {item1: "T3", item2: "E11"},
            {item1: "T3", item2: "E12"},
            {item1: "T3", item2: "E13"},
            {item1: "T3", item2: "E15"},
            {item1: "T3", item2: "E16"},
        ]

        // // Create a constructor function for creating an object with info for each space
        // function ConceptSpaceCreator(concept_space,concept_object,dim1_name,dim2_name,
        //     ex_pairs_img_height,ex_pairs_img_width,ex_pairs_x_coord,ex_pairs_y_coord,
        //     fb_img_1_x_coord,fb_img_1_y_coord,fb_img_2_x_coord,fb_img_2_y_coord,
        //     fb_text_1_x_coord,fb_text_1_y_coord,fb_text_2_x_coord,fb_text_2_y_coord,){

        //         this.concept_space     = concept_space,
        //         this.concept_object    = concept_object,
        //         this.dim1_name         = dim1_name,
        //         this.dim2_name         = dim2_name,
        //         this.ex_pairs_img_height   = ex_pairs_img_height,
        //         this.ex_pairs_img_width    = ex_pairs_img_width,
        //         this.ex_pairs_x_coord  = ex_pairs_x_coord,
        //         this.ex_pairs_y_coord  = ex_pairs_y_coord,
        //         this.fb_img_1_x_coord  = fb_img_1_x_coord,
        //         this.fb_img_1_y_coord  = fb_img_1_y_coord,
        //         this.fb_img_2_x_coord  = fb_img_2_x_coord,
        //         this.fb_img_2_y_coord  = fb_img_2_y_coord,
        //         this.fb_text_1_x_coord = fb_text_1_x_coord,
        //         this.fb_text_1_y_coord = fb_text_1_y_coord,
        //         this.fb_text_2_x_coord = fb_text_2_x_coord,
        //         this.fb_text_2_y_coord = fb_text_2_y_coord                
        // }

        // var neck_legs_space = new ConceptSpaceCreator('neck_legs_space','birds',
        //     'neck','legs',500,350,10,10,10,400,600,400,70,200,170,300)
            
        // debugger

        var neck_legs_space = {
            concept_space: 'neck_legs_space',
            concept_object: 'birds',
            dim1_name: 'neck',
            dim2_name: 'legs',
            ex_pairs_img_height: undefined, 
            ex_pairs_img_width: 350,
            ex_pairs_x_coord: 10,
            ex_pairs_y_coord: 10,
            onscreen_idx_x_coords: [170,525],
            onscreen_idx_y_coords: [350,400],
            
            fb_imgs_x_coords: [90,560],
            fb_imgs_y_coords: [350,400],            
        }

        var beak_tail_space = {
            concept_space: 'beak_tail_space',
            concept_object: 'birds',
            dim1_name: 'beak',
            dim2_name: 'tail',
            ex_pairs_img_height: undefined, 
            ex_pairs_img_width: 650,
            ex_pairs_x_coord: 10,
            ex_pairs_y_coord: 10,
            onscreen_idx_x_coords: [220,310],
            onscreen_idx_y_coords: [220,400],
            
            fb_imgs_x_coords: [90,180],
            fb_imgs_y_coords: [250,450],            
        }        

        var curr_space_object = beak_tail_space

        // Create a counterballanced array indicating which item is the prompt item
        for(i = 0, j=0; i < baseTrialArray.length; i+=2, j++){
            if(j % 2 == 0){
                baseTrialArray[i].prompt_item_idx   = 1
                baseTrialArray[i+1].prompt_item_idx = 1
                baseTrialArray[i].foil_item_idx     = 2
                baseTrialArray[i+1].foil_item_idx   = 2                                
            } else {
                baseTrialArray[i].prompt_item_idx   = 2
                baseTrialArray[i+1].prompt_item_idx = 2
                baseTrialArray[i].foil_item_idx     = 1
                baseTrialArray[i+1].foil_item_idx   = 1                
            }
        }

        // Populate the baseTrialArray with details for each trial
        for(i = 0, j = 0; i < baseTrialArray.length; i++, j+=2) {

            // Randomize item1 and item2
            if (i % 2 == 0){
                [baseTrialArray[i].item1, baseTrialArray[i].item2] = [baseTrialArray[i].item2, baseTrialArray[i].item1]               
            }

            // img names and paths for items. Also point names
            baseTrialArray[i].item_img_names = []
            baseTrialArray[i].item_img_paths = []
            baseTrialArray[i].item_point_idxs = []
            for (j=0; j<2; j++){
                baseTrialArray[i].item_img_names[j] = targetCoordsNames.imgNamesUsed[targetCoordsNames.pointNamesUsed.indexOf(baseTrialArray[i]['item'+(j+1)])] 
                baseTrialArray[i].item_img_paths[j] = './img/targets/' + baseTrialArray[i].item_img_names[j] + '.png'
                baseTrialArray[i].item_point_idxs[j] = targetCoordsNames.pointNamesUsed.indexOf(baseTrialArray[i]['item'+(j+1)])+1
            }

            // point name of the prompt item?
            baseTrialArray[i].prompt_point_name = baseTrialArray[i]["item" + baseTrialArray[i].prompt_item_idx]
            // target name of the prompt item?
            baseTrialArray[i].prompt_img_name = 
                targetCoordsNames.imgNamesUsed[targetCoordsNames.pointNamesUsed.indexOf(baseTrialArray[i].prompt_point_name)]
            // prompt img path?
            baseTrialArray[i].prompt_img_path = './img/targets/' + baseTrialArray[i].prompt_img_name + '.png'
            // point name of the foil item?
            baseTrialArray[i].foil_point_name = baseTrialArray[i]["item" + baseTrialArray[i].foil_item_idx]
            // target name of the foil item?
            baseTrialArray[i].foil_img_name = 
                targetCoordsNames.imgNamesUsed[targetCoordsNames.pointNamesUsed.indexOf(baseTrialArray[i].foil_point_name)]
            // foil img path?
            baseTrialArray[i].foil_img_path = './img/targets/' + baseTrialArray[i].foil_img_name + '.png'
            // Exemplar img to load?
            // baseTrialArray[i].ex_pairs_img_path = './img/' + curr_space_object.concept_space + '/pair_imgs_both_orders/pairs_' + 
            //         baseTrialArray[i].item_point_idxs[0] + '_' + baseTrialArray[i].item_point_idxs[1] + '.png'            
            baseTrialArray[i].ex_pairs_img_path = './img/' + curr_space_object.concept_space + '/pair_imgs_both_orders/pairs_16_16.png'                
        }

        // Shuffle base trial array


        // //////////// FREE SORT PLUGIN //////////////////////////////
        var session_procedure = {
            timeline: [
                {
                    type: 'plugin-playground',
            
                    prompt_img_name: jsPsych.timelineVariable('prompt_img_name'),
                    prompt_img_path: jsPsych.timelineVariable('prompt_img_path'),
                    prompt_img_width: basic_parameters.prompt_target_width,
                    prompt_img_height: basic_parameters.prompt_target_height,
                    prompt_img_x_coords: basic_parameters.prompt_img_x_coords,
                    prompt_img_y_coords: basic_parameters.prompt_img_y_coords,
                    
                    ex_pairs_img_path:    jsPsych.timelineVariable('ex_pairs_img_path'),
                    ex_pairs_img_width:  curr_space_object.ex_pairs_img_width,
                    ex_pairs_img_height: curr_space_object.ex_pairs_img_height,
                    ex_pairs_maintain_aspect_ratio: true,

                    onscreen_idx: ['1','2'],
                    onscreen_idx_x_coords: curr_space_object.onscreen_idx_x_coords,
                    onscreen_idx_y_coords: curr_space_object.onscreen_idx_y_coords,                    
                                         
                    fb_correct_img: basic_parameters.fb_correct_img,
                    fb_incorrect_img: basic_parameters.fb_incorrect_img,

                    audio_stimulus: basic_parameters.audio_stimulus,

                    fb_img_paths: jsPsych.timelineVariable('item_img_paths'),
                    item_img_names: jsPsych.timelineVariable('item_img_names'),             

                    fb_imgs_x_coords: curr_space_object.fb_imgs_x_coords,
                    fb_imgs_y_coords: curr_space_object.fb_imgs_y_coords,                    

                    score_box_target_names: score_box_target_names,

                    sort_area_width: 750,
                    sort_area_height: 700,
                    prompt: 'Which of the two pictures below are associated with this Christmas toy?',
                    choices: ['1', '2'],
                    response_ends_trial: true,
                    timer_till_fb: basic_parameters.timer_till_fb,
                    timer_after_response: basic_parameters.timer_after_response,
                    timer_no_resp_fb_freeze: basic_parameters.timer_no_resp_fb_freeze,
                    timer_response_window: basic_parameters.timer_response_window,
                    post_trial_gap: 500,
                    correct_response: jsPsych.timelineVariable('prompt_item_idx')
                }
            ],

            timeline_variables: baseTrialArray
        };
 
        jsPsych.init({
            timeline: [session_procedure],
            use_webaudio: false
        });


        // ///////////////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////////////////////////////

    </script>
</html>
