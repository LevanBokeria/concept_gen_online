<!doctype html>
<html lang="en">
  <head>
	<title>Break</title>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0">
    <title>Dissimilarity Study</title>	
	<script src="jspsych-6.1.0/jspsych.js" ></script>
	<script src="jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
	<script src="jatos.js"></script>
	<script src="./extra_functions/jspsych-instructions-timer.js"></script>
    <link rel="stylesheet" href="jspsych-6.1.0/css/jspsych.css" type="text/css"></link>
	<style>	body {background-color: #b9c6c7; font-family: sans-serif; color: black;} </style>
	<style> p {font-size: 125%; margin-top:0px; margin-right:100px; margin-bottom:20px; margin-left: 100px;} </style>
	<style> ul {font-size: 125%; margin-top:0px; margin-right:100px; margin-bottom:20px; margin-left: 100px; cursor:default;} </style>
	<style> .instruct{width:100%; color: black; text-align:center; cursor:default;} </style>
	<style> .header {position: fixed; left:0; top:0; width:100%; background-color:#8f8d8d; color: white; text-align: center;cursor:default;} </style>
  </head>

  <body>
  <script>

	//start timeline
	jatos.onLoad(function() {

		// What phase is this?
		let [curr_phase,phase_string,curr_session] = getPhaseAndSession()

		// Create the score box
		



		//make a timeline
		var timeline = []; 

		//make a welcome message
		var short_break_trial = {
			type: 'instructions-timer',
			pages: [
				'<p> Thank you so much for completing this session! <br> ' + 
				'You are doing great! <br> ' +
				'We really appreciate you staying attentive and continuing to honestly perform the task. </p>' +
				+ '<p> Below you can see your scores from the last session: </p>' +
				'<p><br> Please take a ' + jatos.studySessionData.short_break_duration + 
				' second break and click the Next button or press the right-arrow button on the keyboard to start the next session. </p>'
			],
			show_clickable_nav: true,
			button_label_next: "<span style='color: blue';> <strong> Next </stong></span>",
			n_seconds: jatos.studySessionData.short_break_duration

		};

		//make a welcome message
		var long_break_trial = {
			type: 'instructions-timer',
			pages: [
				'<p> Wonderful! You have done a great job at staying attentive. Thank you very much once again!' +
				'<p> For the next 2 sessions, you will be tested once more on the same 128 pairs of pictures.</p>' + 
				'<p> The ratings you give to the upcoming pictures do not have to be the same that you gave before.' +
				'<p><br> For example, if for a certain level of perceived similarity you previously used 5 but now you think that ' + 
				'8 is more appropriate, you can respond with 8.</p>' + 
				'<p><br> Click the Next button or press the right-arrow button on your keyboard once you are ready to start the next session.'
			],
			show_clickable_nav: true,
			button_label_next: "<span style='color: blue';> <strong> Next </stong></span>",
			n_seconds: jatos.studySessionData.long_break_duration

		};


		// Check, if exceeded the performance, then continue to phase 2
		let n_targets_learned = 
			jatos.studySessionData.inputData.score_box_target_paths.running_perf.filter(item => item >= 
			jatos.studySessionData.training_criterion).length

		if (n_targets_learned == jatos.studySessionData.inputData.basic_parameters.nTargets & curr_phase == 1) {
			// So phase 1 completed, load instructions

			timeline.push(long_break_trial)

		} else {
			// So load short break instructions
			timeline.push(short_break_trial)

		}

		jsPsych.init({

			timeline: timeline,

			on_finish: function() {

				jatos.studySessionData.outputData[phase_string + '_breaks_results'][
					jatos.studySessionData.outputData[phase_string + '_breaks_results'].length
				] = jsPsych.data.get().values();

				jatos.submitResultData("[short_break_start---" + 
				JSON.stringify(jatos.studySessionData) + 
				"---short_break_end]", function(){
					jatos.startComponentByPos(jatos.studySessionData.script_comp_pos.phase_pa);
				});
			}
		});

	});

	</script>
</body>
</html>